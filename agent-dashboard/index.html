<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crawley — Agent Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="title">
      <h1>Crawley — Agent Dashboard</h1>
      <div class="subtitle">Simple 2D overview (manual refresh / light auto-poll)</div>
    </div>
    <div class="controls">
      <button id="refreshBtn">Refresh now</button>
      <label class="toggle">
        <input id="autoRefresh" type="checkbox" checked />
        <span>Live updates (SSE) + fallback poll (5s)</span>
      </label>
    </div>
  </header>

  <main>
    <section class="panel">
      <div class="panel-header">
        <h2>Map</h2>
        <div class="muted">Last update: <span id="lastUpdate">—</span></div>
      </div>

      <div id="map" class="map" aria-label="Agent map" role="img">
        <svg id="mapSvg" viewBox="0 0 1000 520" preserveAspectRatio="xMidYMid meet">
          <defs>
            <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="#00122b" flood-opacity="0.18" />
            </filter>

            <linearGradient id="wall" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#ffffff" stop-opacity="0.40" />
              <stop offset="100%" stop-color="#dbe6ff" stop-opacity="0.25" />
            </linearGradient>

            <linearGradient id="floor" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#ffffff" stop-opacity="0.62" />
              <stop offset="100%" stop-color="#dfe9ff" stop-opacity="0.40" />
            </linearGradient>

            <pattern id="microGrid" width="40" height="40" patternUnits="userSpaceOnUse">
              <path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(11,18,32,0.05)" stroke-width="1" />
            </pattern>
          </defs>

          <rect x="20" y="20" width="960" height="480" rx="18" class="grid" />
          <rect x="20" y="20" width="960" height="480" rx="18" fill="url(#microGrid)" opacity="0.7" />

          <!-- scene details (command room – subtle, not cluttered) -->
          <g opacity="0.92">
            <!-- back wall panel -->
            <rect x="60" y="66" width="880" height="105" rx="18" fill="url(#wall)" stroke="rgba(11,18,32,0.08)" />
            <rect x="86" y="92" width="248" height="54" rx="14" fill="rgba(43,108,255,0.10)" stroke="rgba(11,18,32,0.10)" />
            <rect x="362" y="92" width="276" height="54" rx="14" fill="rgba(22,164,135,0.09)" stroke="rgba(11,18,32,0.10)" />
            <rect x="666" y="92" width="248" height="54" rx="14" fill="rgba(255,204,102,0.10)" stroke="rgba(11,18,32,0.10)" />

            <!-- floor platform -->
            <rect x="60" y="360" width="880" height="105" rx="18" fill="url(#floor)" stroke="rgba(11,18,32,0.08)" />

            <!-- console desks -->
            <rect x="120" y="392" width="220" height="50" rx="14" fill="rgba(255,255,255,0.58)" stroke="rgba(11,18,32,0.10)" />
            <rect x="390" y="392" width="220" height="50" rx="14" fill="rgba(255,255,255,0.58)" stroke="rgba(11,18,32,0.10)" />
            <rect x="660" y="392" width="220" height="50" rx="14" fill="rgba(255,255,255,0.58)" stroke="rgba(11,18,32,0.10)" />

            <!-- tiny monitors + glow -->
            <rect x="145" y="375" width="55" height="25" rx="8" fill="rgba(43,108,255,0.14)" stroke="rgba(11,18,32,0.10)" />
            <rect x="415" y="375" width="55" height="25" rx="8" fill="rgba(43,108,255,0.14)" stroke="rgba(11,18,32,0.10)" />
            <rect x="685" y="375" width="55" height="25" rx="8" fill="rgba(43,108,255,0.14)" stroke="rgba(11,18,32,0.10)" />

            <!-- small plant + lamp (tiny ambience) -->
            <path d="M 905 448 C 912 430, 930 430, 936 448" fill="none" stroke="rgba(11,18,32,0.14)" stroke-width="3" stroke-linecap="round" />
            <path d="M 920 448 C 916 438, 916 430, 920 420 C 924 430, 924 438, 920 448" fill="rgba(22,164,135,0.18)" stroke="rgba(11,18,32,0.10)" stroke-width="1.5" />
            <circle cx="96" cy="402" r="10" fill="rgba(255,233,214,0.65)" stroke="rgba(11,18,32,0.10)" />
            <path d="M 96 412 L 96 438" stroke="rgba(11,18,32,0.14)" stroke-width="3" stroke-linecap="round" />
          </g>

          <g id="agentsLayer"></g>
        </svg>
      </div>

      <div class="legend">
        <span class="pill idle">Idle</span>
        <span class="pill running">Running</span>
        <span class="pill blocked">Blocked</span>
        <span class="pill warning">Needs review</span>
      </div>
    </section>

    <section class="panel">
      <div class="panel-header">
        <h2>Agents</h2>
        <div class="muted">Data source: <code>status.json</code></div>
      </div>

      <div id="cards" class="cards"></div>

      <details class="panel" style="margin-top:12px;">
        <summary>How to update statuses</summary>
        <div class="details-body">
          <p>Edit <code>status.json</code> (same folder) to set tasks/status/ETA. This dashboard reads it.</p>
          <p>Later we can wire it to OpenClaw session activity, but this MVP keeps security + cost low.</p>
        </div>
      </details>
    </section>
  </main>

  <footer>
    <div class="muted">Security note: serve this over an SSH tunnel or behind auth/TLS if you expose it publicly.</div>
  </footer>

  <script src="app.js"></script>
</body>
</html>
